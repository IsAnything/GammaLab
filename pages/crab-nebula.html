<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crab Nebula - GammaLab</title>
    <link rel="stylesheet" href="../css/main-style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="site-title">ğŸ”­ GammaLab</h1>
            <p class="site-subtitle">ğŸ¦€ Crab Nebula - La Candela Standard dell'Astronomia Gamma</p>
            
            <nav>
                <ul class="nav-menu">
                    <li><a href="../homepage.html">ğŸ  Home</a></li>
                    <li><a href="intro-cherenkov.html">ğŸ’¡ Introduzione</a></li>
                    <li><a href="crab-nebula.html" class="active">ğŸ¦€ Crab Nebula</a></li>
                    <li><a href="supernova-remnants.html">ğŸ’¥ Resti di Supernova</a></li>
                    <li><a href="blazars.html">ğŸŒ€ Blazar (AGN)</a></li>
                    <li><a href="grb.html">âš¡ GRB</a></li>
                    <li><a href="galactic-center.html">â­ Centro Galattico</a></li>
                    <li><a href="comparison.html">ğŸ“Š Confronto</a></li>
                    <li><a href="hadronic-background.html">âš›ï¸ Background Adronico</a></li>
                    <li><a href="quiz.html">ğŸ® Quiz</a></li>
                </ul>
            </nav>
            <div class="page-simulator-cta" style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px;">
                <a href="crab-nebula-simulator.html" class="btn btn-primary" style="font-size: 1rem;">
                    ğŸ® Vai al Simulatore della Crab
                </a>
                <a href="crab-nebula-simulator.html?autogen=1" class="btn btn-secondary" style="font-size: 1rem;">
                    âš¡ Avvia Evento Rapido Crab
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Immagine Reale -->
        <section class="card">
            <h2>ğŸ¦€ Crab Nebula: La Candela Standard</h2>
            <div style="text-align: center; margin: 24px 0;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Crab_Nebula.jpg/800px-Crab_Nebula.jpg" 
                     alt="Crab Nebula - NASA/ESA Hubble Space Telescope" 
                     style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5);">
                <p style="margin-top: 12px; font-size: 0.9rem; color: var(--text-secondary);">
                    ğŸ“¸ <strong>Crab Nebula</strong> - Immagine composita Hubble Space Telescope (NASA/ESA)<br>
                    La nebulosa Ã¨ il resto della supernova SN 1054, osservata dagli astronomi cinesi nel 1054 d.C.<br>
                    Al centro si trova la Crab Pulsar, stella di neutroni che ruota 30 volte al secondo.
                </p>
                <div style="margin-top: 18px;">
                    <a href="crab-nebula-simulator.html" class="btn btn-primary" style="font-size:1.05rem; padding:12px 28px;">
                        ğŸš€ Avvia Simulatore Crab (Apri)
                    </a>
                    <a href="crab-nebula-simulator.html?autogen=1" class="btn btn-secondary" style="font-size:1.05rem; padding:12px 20px; margin-left:12px;">
                        ğŸŒŸ Genera Evento (Apri Simulatore)
                    </a>
                </div>
            </div>
        </section>

        <!-- Introduzione -->
        <section class="card">
            <h2>ğŸ“ La Candela Standard dell'Astronomia Gamma</h2>
            <p>
                La <strong>Nebulosa del Granchio</strong> Ã¨ situata nella costellazione del Toro a circa 
                <strong>6500 anni luce</strong> dalla Terra. Ãˆ considerata la <strong>"candela standard"</strong> 
                dell'astronomia gamma perchÃ©:
            </p>
            <ul>
                <li>ğŸ“ <strong>Sorgente puntiforme</strong>: Dimensione angolare ~4' (molto piccola per IACT)</li>
                <li>ğŸ”„ <strong>Emissione stabile</strong>: Flusso costante nel tempo (Â±5% variazioni)</li>
                <li>âš¡ <strong>Spettro ben noto</strong>: Studiata da 50-60 GeV fino a 100+ TeV</li>
                <li>ğŸ¯ <strong>Riferimento di calibrazione</strong>: Usata per verificare performance strumentali</li>
            </ul>
        </section>

        <!-- Fisica della Sorgente -->
        <section class="card">
            <h2>âš™ï¸ Fisica della Crab Nebula</h2>
            
            <h3>ğŸŒŸ La Pulsar del Granchio</h3>
            <p>
                Al centro della nebulosa si trova la <strong>Crab Pulsar (PSR B0531+21)</strong>, 
                una stella di neutroni che ruota <strong>~30 volte al secondo</strong>. Questa 
                rotazione ultra-rapida genera:
            </p>
            <ul>
                <li><strong>Vento relativistico</strong>: Particelle accelerate a energie estreme</li>
                <li><strong>Campo magnetico intenso</strong>: B ~ 10Â¹Â² Gauss</li>
                <li><strong>Emissione pulsata</strong>: Dalle onde radio ai raggi gamma (>100 GeV)</li>
            </ul>

            <h3>ğŸ’¨ Vento della Pulsar e Nebulosa</h3>
            <p>
                Il vento della pulsar si scontra con il materiale espulso dalla supernova, 
                creando una <strong>nebulosa a vento di pulsar (PWN - Pulsar Wind Nebula)</strong>. 
                In questa regione:
            </p>
            <ul>
                <li>Gli <strong>elettroni e positroni</strong> vengono accelerati a energie ultra-relativistiche (fino a PeV)</li>
                <li>Queste particelle interagiscono con fotoni ambientali tramite <strong>Compton inverso</strong></li>
                <li>Il risultato Ã¨ l'emissione di <strong>raggi gamma</strong> da GeV a multi-TeV</li>
            </ul>

            <h3>ğŸ“Š Caratteristiche Spettrali</h3>
            <table>
                <thead>
                    <tr>
                        <th>Parametro</th>
                        <th>Valore</th>
                        <th>Nota</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Flusso (>1 TeV)</strong></td>
                        <td>~2 Ã— 10â»Â¹Â¹ cmâ»Â² sâ»Â¹</td>
                        <td>Usato come unitÃ  "Crab Units"</td>
                    </tr>
                    <tr>
                        <td><strong>Indice spettrale</strong></td>
                        <td>Î“ ~ 2.6-2.7</td>
                        <td>Spettro di tipo power-law</td>
                    </tr>
                    <tr>
                        <td><strong>Cutoff energetico</strong></td>
                        <td>>100 TeV</td>
                        <td>Limite superiore ancora incerto</td>
                    </tr>
                    <tr>
                        <td><strong>VariabilitÃ </strong></td>
                        <td><5%</td>
                        <td>Eccetto rare flare ottici</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Parametri IACT Tipici -->
        <section class="card">
            <h2>ğŸ“¸ Firma Cherenkov della Crab Nebula</h2>
            <p>
                Le osservazioni IACT della Crab mostrano caratteristiche distintive che la 
                rendono facilmente riconoscibile:
            </p>

            <h3>Parametri di Hillas Tipici</h3>
            <table>
                <thead>
                    <tr>
                        <th>Parametro</th>
                        <th>Range Tipico</th>
                        <th>Valore Medio</th>
                        <th>Interpretazione</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Length</strong></td>
                        <td>0.20Â° - 0.30Â°</td>
                        <td>~0.25Â°</td>
                        <td>Tracce compatte, energia moderata (~1 TeV)</td>
                    </tr>
                    <tr>
                        <td><strong>Width</strong></td>
                        <td>0.05Â° - 0.10Â°</td>
                        <td>~0.08Â°</td>
                        <td>Sciami sottili, ben collimati</td>
                    </tr>
                    <tr>
                        <td><strong>Size</strong></td>
                        <td>800 - 1200 p.e.</td>
                        <td>~1000 p.e.</td>
                        <td>Corrispondente a E ~ 0.5-2 TeV</td>
                    </tr>
                    <tr>
                        <td><strong>Alpha (Î±)</strong></td>
                        <td>0Â° - 5Â°</td>
                        <td>~0Â° (picco)</td>
                        <td>Sorgente puntiforme â†’ Î± â†’ 0Â°</td>
                    </tr>
                    <tr>
                        <td><strong>L/W Ratio</strong></td>
                        <td>2.5 - 4.0</td>
                        <td>~3.1</td>
                        <td>Ellissi allungate e regolari</td>
                    </tr>
                </tbody>
            </table>

            <h3>ğŸ¯ Caratteristiche Distintive</h3>
            <ul>
                <li><strong>Coerenza stereoscopica eccellente</strong>: I parametri di Hillas sono molto simili tra le 3 camere (varianza inter-camera bassa: Ïƒ ~ 5-10%)</li>
                <li><strong>Alpha clustering</strong>: Forte picco a Î± ~ 0Â°, distribuzioni strette (Ïƒ_Î± ~ 2-3Â°)</li>
                <li><strong>Forme regolari</strong>: Ellissi pulite senza irregolaritÃ  o doppi picchi</li>
                <li><strong>Size consistente</strong>: Distribuzioni di Size centrate attorno a 1000 p.e. con spread moderato</li>
            </ul>

            <h3>ğŸ“ Conversione Angolare</h3>
            <p>
                Nella simulazione usiamo la conversione: <strong>1Â° = 100 pixel</strong>
            </p>
            <ul>
                <li>Length ~ 0.25Â° â†’ <strong>25 pixel</strong></li>
                <li>Width ~ 0.08Â° â†’ <strong>8 pixel</strong></li>
                <li>Campo di vista camera: 1500Ã—1000 px â†’ <strong>15Â° Ã— 10Â°</strong></li>
            </ul>
        </section>

        <!-- Link al Simulatore -->
        <section class="card" style="text-align: center; background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(139,92,246,0.1) 100%); border: 2px solid var(--accent-purple);">
            <h2>ğŸ® Simulatore IACT Interattivo</h2>
            <p style="font-size: 1.1rem; margin: 24px 0;">
                Vuoi vedere come i telescopi Cherenkov rilevano i raggi gamma dalla Crab Nebula?
            </p>
            <p style="color: var(--text-secondary); margin-bottom: 32px;">
                Il simulatore mostra in tempo reale come 3 telescopi catturano lo stesso evento da angolazioni diverse,
                permettendoti di analizzare i parametri di Hillas e la ricostruzione stereoscopica.
            </p>
            <a href="crab-nebula-simulator.html" class="btn btn-primary" style="font-size: 1.2rem; padding: 16px 48px;">
                ğŸš€ Avvia Simulatore Crab Nebula
            </a>
        </section>

        <!-- Simulatore (OLD - nascosto) -->
        <section class="card simulator-section" style="display: none;">
            <h2>ğŸ® Simulatore IACT - Crab Nebula</h2>
            <p>
                Questa simulazione mostra come apparirebbe un evento gamma dalla Crab Nebula 
                osservato da <strong>3 telescopi Cherenkov</strong> in configurazione stereoscopica.
            </p>
            <p style="color: var(--text-secondary); font-size: 0.95em;">
                ğŸ’¡ <strong>Nota</strong>: Clicca su "Genera Evento" per simulare l'arrivo di un fotone gamma. 
                Osserva come le 3 camere catturano lo stesso sciame da angolazioni diverse, 
                producendo parametri di Hillas coerenti con la caratteristica "firma" della Crab.
            </p>

            <div style="text-align: center; margin: 24px 0;">
                <button id="generateBtn" class="btn btn-primary">ğŸŒŸ Genera Evento Crab</button>
                <button id="clearBtn" class="btn btn-secondary">ğŸ—‘ï¸ Pulisci</button>
            </div>

            <!-- 3 Camere -->
            <div class="cameras-grid">
                <div class="camera-container">
                    <div class="camera-label">ğŸ“· Camera 1 (Nord)</div>
                    <canvas id="cam1" class="camera-canvas" width="900" height="600"></canvas>
                    <canvas id="cam1-overlay" class="camera-canvas overlay-canvas" width="900" height="600"></canvas>
                </div>
                <div class="camera-container">
                    <div class="camera-label">ğŸ“· Camera 2</div>
                    <canvas id="cam2" class="camera-canvas" width="900" height="600"></canvas>
                    <canvas id="cam2-overlay" class="camera-canvas overlay-canvas" width="900" height="600"></canvas>
                </div>
                <div class="camera-container">
                    <div class="camera-label">ğŸ“· Camera 3</div>
                    <canvas id="cam3" class="camera-canvas" width="900" height="600"></canvas>
                    <canvas id="cam3-overlay" class="camera-canvas overlay-canvas" width="900" height="600"></canvas>
                </div>
            </div>

            <!-- Pannello Parametri di Hillas -->
            <div class="hillas-panel">
                <h3>ğŸ“Š Parametri di Hillas Misurati</h3>
                <div id="hillasDisplay">
                    <p style="text-align: center; color: var(--text-secondary);">
                        Genera un evento per visualizzare i parametri di Hillas
                    </p>
                </div>
            </div>

            <!-- Ricostruzione Stereoscopica -->
            <div class="stereo-container">
                <h3 style="color: var(--accent-purple);">ğŸ”º Ricostruzione Stereoscopica</h3>
                <p style="color: var(--text-secondary); margin-bottom: 16px;">
                    La triangolazione dagli assi delle 3 ellissi determina la direzione di arrivo del fotone gamma
                </p>
                <canvas id="stereo" class="stereo-canvas" width="960" height="720"></canvas>
            </div>
        </section>

        <!-- Confronto con Altre Sorgenti -->
        <section class="card">
            <h2>âš–ï¸ Confronto con Altre Sorgenti</h2>
            <p>
                La Crab Nebula serve da riferimento per caratterizzare altre sorgenti. 
                Ecco le principali differenze:
            </p>

            <table>
                <thead>
                    <tr>
                        <th>Caratteristica</th>
                        <th>Crab Nebula</th>
                        <th>PeVatron</th>
                        <th>Blazar</th>
                        <th>GRB</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Length</strong></td>
                        <td>~0.25Â° (compatta)</td>
                        <td>~0.40Â° (estesa)</td>
                        <td>~0.15Â° (piccola)</td>
                        <td>~0.18Â° (variabile)</td>
                    </tr>
                    <tr>
                        <td><strong>Size</strong></td>
                        <td>~1000 p.e.</td>
                        <td>>2000 p.e. âš¡</td>
                        <td>~1200 p.e.</td>
                        <td>~1500 p.e.</td>
                    </tr>
                    <tr>
                        <td><strong>Alpha</strong></td>
                        <td>~0Â° (picco stretto)</td>
                        <td>5-15Â° (disperso)</td>
                        <td>~0Â° (punto)</td>
                        <td>~0Â° (iniziale)</td>
                    </tr>
                    <tr>
                        <td><strong>VariabilitÃ </strong></td>
                        <td>Stabile (<5%)</td>
                        <td>Moderata</td>
                        <td>Alta (ore-giorni)</td>
                        <td>Estrema (sec)</td>
                    </tr>
                    <tr>
                        <td><strong>Coerenza</strong></td>
                        <td>Eccellente (Ïƒ~5%)</td>
                        <td>Buona (Ïƒ~10%)</td>
                        <td>Eccellente</td>
                        <td>Buona</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Osservazioni Reali -->
        <section class="card">
            <h2>ğŸ”¬ Osservazioni Reali della Crab</h2>
            
            <h3>Scoperta in Raggi Gamma</h3>
            <p>
                La Crab Nebula Ã¨ stata una delle prime sorgenti TeV confermate:
            </p>
            <ul>
                <li><strong>1989</strong>: Prima rilevazione da parte del Whipple Observatory (>1 TeV)</li>
                <li><strong>Anni '90-2000</strong>: Conferme da HEGRA, CAT, VERITAS</li>
                <li><strong>2004-2005</strong>: Osservazioni dettagliate con MAGIC e H.E.S.S.</li>
                <li><strong>2011</strong>: Fermi-LAT rileva "flare" inattesi a energie >100 MeV</li>
            </ul>

            <h3>ğŸ“ˆ Performance come Riferimento</h3>
            <p>
                Gli osservatori IACT usano la Crab per:
            </p>
            <ul>
                <li><strong>Calibrazione</strong>: Verificare che l'array funzioni correttamente</li>
                <li><strong>SensibilitÃ </strong>: Misurare il tempo necessario per rilevare "1 Crab" (tipicamente ~25 ore per 5Ïƒ a E>1 TeV)</li>
                <li><strong>Risoluzione angolare</strong>: Testare la precisione di ricostruzione (~0.1Â° @ 1 TeV)</li>
                <li><strong>Risoluzione energetica</strong>: Verificare Î”E/E ~ 10-15%</li>
            </ul>

            <h3>ğŸ“ Importanza Scientifica</h3>
            <p>
                Nonostante sia studiata da decenni, la Crab rimane oggetto di ricerca attiva:
            </p>
            <ul>
                <li><strong>Cutoff energetico</strong>: Dove si ferma lo spettro? HAWC ha visto emissione >100 TeV</li>
                <li><strong>Flare ottici</strong>: Eventi improvvisi nel "wisp" interno alla nebulosa</li>
                <li><strong>Fisica della pulsar</strong>: Meccanismi di emissione pulsata ad alta energia</li>
                <li><strong>Accelerazione</strong>: Come si raggiungono energie PeV?</li>
            </ul>
        </section>

        <!-- Prossimi Passi -->
        <section class="card">
            <h2>ğŸš€ Esplora Altre Sorgenti</h2>
            <p>
                Ora che hai visto la "sorgente di riferimento", esplora sorgenti piÃ¹ estreme:
            </p>
            <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 24px;">
                <a href="supernova-remnants.html" class="btn btn-primary">ğŸ’¥ Resti di Supernova (PeVatron)</a>
                <a href="blazars.html" class="btn btn-primary">ğŸŒ€ Blazar (AGN)</a>
                <a href="comparison.html" class="btn btn-secondary">ğŸ“Š Tabella Comparativa</a>
            </div>
        </section>
    </main>

    <footer style="margin-top: 48px; padding: 24px; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-secondary);">
        <p><strong>GammaLab</strong> - Simulatore educativo di telescopi Cherenkov atmosferici</p>
    </footer>

    <script src="../js/core-simulation.js?v=7"></script>
    <script src="../js/source-profiles.js?v=7"></script>
    <script src="../js/hillas-analysis.js?v=7"></script>
    <script src="../js/visualization.js?v=20"></script>
    <script src="../js/stereo-reconstruction.js?v=7"></script>
    <script src="../js/navigation.js?v=7"></script>
    <script src="../js/lightbox.js"></script>
    <script>
        // === SIMULATORE CRAB NEBULA ===
        let engine, renderers, hillasAnalyzer, colorPalette;

        document.addEventListener('DOMContentLoaded', () => {
            // Inizializza componenti
            engine = new SimulationEngine();
            hillasAnalyzer = new HillasAnalyzer();
            colorPalette = new EnergyColorPalette();
            engine.colorPalette = colorPalette;

            // Inizializza renderers per 3 camere
            renderers = [
                new CanvasRenderer('cam1', 'cam1-overlay'),
                new CanvasRenderer('cam2', 'cam2-overlay'),
                new CanvasRenderer('cam3', 'cam3-overlay')
            ];

            // Assegna nuova palette e modalitÃ  ellissi hover a tutti i renderers
            renderers.forEach(renderer => {
                renderer.colorPalette = colorPalette;
                if (typeof renderer.enableHoverHillasMode === 'function') {
                    renderer.enableHoverHillasMode();
                }
            });

            console.log('ğŸ¨ Nuova palette 5 colori assegnata ai renderers');

            // Event listeners
            document.getElementById('generateBtn').addEventListener('click', generateCrabEvent);
            document.getElementById('clearBtn').addEventListener('click', clearAllCanvases);

            console.log('âœ… Simulatore Crab Nebula inizializzato');
            
            // Auto-genera primo evento
            setTimeout(() => {
                console.log('ğŸ¬ Auto-generating initial Crab event...');
                generateCrabEvent();
            }, 500);
        });

        /**
         * Genera evento Crab Nebula completo (3 camere + stereo)
         */
        function generateCrabEvent() {
            console.log('ğŸ¦€ Generazione evento Crab Nebula...');

            const crabProfile = getSourceProfile('crab');
            const events = [];
            const hillasParams = [];
            const hillasMap = {};

            // Genera per 3 camere
            for (let i = 0; i < 3; i++) {
                const cameraId = i + 1;
                const camKey = `cam${cameraId}`;
                
                // Genera evento
                const event = engine.generateEvent(crabProfile, cameraId);
                events.push(event);

                // Rendering con palette giÃ  configurata
                renderers[i].renderEvent(event, i === 0);
                console.log(`ğŸ¨ Camera ${cameraId}: ${event.tracks.length} fotoni renderizzati`);

                // Calcola Hillas
                const hillas = hillasAnalyzer.analyze(event);
                if (hillas && hillas.valid) {
                    hillasParams.push(hillas);
                    hillasMap[camKey] = hillas;
                    renderers[i].renderHillasOverlay(hillas);
                }

                console.log(`  Camera ${cameraId}: ${event.tracks.length} fotoni, E=${(event.energy/1000).toFixed(1)} TeV`);
            }

            // Ricostruzione stereoscopica avanzata
            const stereoCanvas = document.getElementById('stereo');
            if (stereoCanvas && hillasParams.length >= 2) {
                if (typeof window.renderStereoReconstruction === 'function') {
                    // Usa nuova stereo reconstruction
                    console.log('ğŸ”º Rendering ricostruzione stereoscopica avanzata');
                    window.renderStereoReconstruction(stereoCanvas, hillasMap, {
                        showGeometry: true,
                        showCameraPositions: true,
                        showArrows: true,
                        showArrivalDirection: true
                    });
                } else {
                    // Fallback a stereo semplice locale
                    const stereoResult = combineStereoscopicEvents(events);
                    renderStereoReconstructionSimple(stereoResult);
                }
            }

            // Mostra parametri Hillas
            displayHillasParameters(hillasParams);

            // Mostra comparazione
            if (hillasParams.length >= 2) {
                const comparison = compareHillasAcrossCameras(hillasParams);
                displayCoherence(comparison);
            }
        }

        /**
         * Renderizza ricostruzione stereoscopica semplice (fallback)
         */
        function renderStereoReconstructionSimple(stereoResult) {
            const canvas = document.getElementById('stereo');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#000814';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Disegna direzioni da ogni camera
            const colors = ['#ff4444', '#44ff44', '#4444ff'];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            stereoResult.events.forEach((event, idx) => {
                const hillas = hillasAnalyzer.analyze(event);
                if (!hillas) return;

                const theta = hillas.theta * Math.PI / 180;
                const length = 200;

                ctx.strokeStyle = colors[idx];
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + length * Math.cos(theta),
                    centerY + length * Math.sin(theta)
                );
                ctx.stroke();

                // Label
                ctx.fillStyle = colors[idx];
                ctx.font = 'bold 14px "Courier New"';
                ctx.fillText(`Cam${idx+1}`, centerX + length * Math.cos(theta) + 10, centerY + length * Math.sin(theta));
            });

            // Punto di intersezione stimato
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
            ctx.fill();

            // Info
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px "Courier New"';
            ctx.fillText('Ricostruzione Stereoscopica', 20, 30);
            ctx.font = '14px "Courier New"';
            ctx.fillText(`Coerenza: ${(stereoResult.coherence * 100).toFixed(1)}%`, 20, 55);
            ctx.fillText(`Camere: ${stereoResult.numCameras}`, 20, 75);
        }

        /**
         * Mostra parametri Hillas nel pannello
         */
        function displayHillasParameters(hillasArray) {
            const container = document.getElementById('hillasDisplay');
            if (!container || hillasArray.length === 0) return;

            let html = '<h4>Parametri di Hillas per Camera</h4>';
            
            hillasArray.forEach((hillas, idx) => {
                html += `
                    <div style="margin-bottom: 20px; padding: 12px; background: rgba(0, 40, 80, 0.3); border-radius: 8px;">
                        <h5 style="color: #00d9ff; margin-bottom: 10px;">ğŸ“· Camera ${idx + 1}</h5>
                        <table style="width: 100%; font-family: 'Courier New', monospace; font-size: 13px;">
                            <tr>
                                <td style="padding: 4px 8px;"><strong>Length:</strong></td>
                                <td>${hillas.length.toFixed(3)}Â° (${hillas.lengthPx.toFixed(1)} px)</td>
                            </tr>
                            <tr>
                                <td style="padding: 4px 8px;"><strong>Width:</strong></td>
                                <td>${hillas.width.toFixed(3)}Â° (${hillas.widthPx.toFixed(1)} px)</td>
                            </tr>
                            <tr style="background: rgba(255, 200, 0, 0.1);">
                                <td style="padding: 4px 8px;"><strong>Size:</strong></td>
                                <td><span style="color: #ffc800;">${hillas.size.toFixed(0)} p.e.</span></td>
                            </tr>
                            <tr>
                                <td style="padding: 4px 8px;"><strong>Alpha:</strong></td>
                                <td>${hillas.alpha.toFixed(1)}Â°</td>
                            </tr>
                            <tr>
                                <td style="padding: 4px 8px;"><strong>L/W Ratio:</strong></td>
                                <td>${hillas.elongation.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 4px 8px;"><strong>Miss:</strong></td>
                                <td>${hillas.miss.toFixed(2)}Â°</td>
                            </tr>
                            <tr>
                                <td style="padding: 4px 8px;"><strong>Fotoni:</strong></td>
                                <td>${hillas.numPhotons}</td>
                            </tr>
                        </table>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        /**
         * Mostra coerenza inter-camera
         */
        function displayCoherence(comparison) {
            const container = document.getElementById('hillasDisplay');
            if (!container) return;

            const coherenceColor = comparison.coherence > 90 ? '#00ff88' : 
                                    comparison.coherence > 80 ? '#ffaa00' : '#ff4444';

            container.innerHTML += `
                <div style="margin-top: 24px; padding: 16px; background: rgba(0, 80, 40, 0.3); border-radius: 8px; border: 2px solid ${coherenceColor};">
                    <h4 style="color: ${coherenceColor};">ğŸ“Š Analisi Stereoscopica</h4>
                    <p><strong>Coerenza Inter-Camera:</strong> <span style="color: ${coherenceColor}; font-size: 20px;">${comparison.coherence.toFixed(1)}%</span></p>
                    <p style="font-size: 13px; color: var(--text-secondary);">
                        ${comparison.coherence > 90 ? 'âœ… Eccellente - Evento gamma altamente probabile' :
                          comparison.coherence > 80 ? 'âš ï¸ Buona - Probabile evento gamma' :
                          'âŒ Bassa - Possibile contaminazione adronica'}
                    </p>
                    <table style="width: 100%; margin-top: 12px; font-family: 'Courier New', monospace; font-size: 13px;">
                        <tr style="background: rgba(255,255,255,0.05);">
                            <th style="padding: 6px; text-align: left;">Parametro</th>
                            <th style="padding: 6px;">Media</th>
                            <th style="padding: 6px;">Varianza</th>
                        </tr>
                        <tr>
                            <td style="padding: 6px;">Length</td>
                            <td style="padding: 6px; text-align: center;">${comparison.average.length.toFixed(3)}Â°</td>
                            <td style="padding: 6px; text-align: center;">Â±${comparison.variance.length.toFixed(3)}Â°</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px;">Width</td>
                            <td style="padding: 6px; text-align: center;">${comparison.average.width.toFixed(3)}Â°</td>
                            <td style="padding: 6px; text-align: center;">Â±${comparison.variance.width.toFixed(3)}Â°</td>
                        </tr>
                        <tr style="background: rgba(255,200,0,0.1);">
                            <td style="padding: 6px;">Size</td>
                            <td style="padding: 6px; text-align: center;"><strong>${comparison.average.size.toFixed(0)} p.e.</strong></td>
                            <td style="padding: 6px; text-align: center;">Â±${comparison.variance.size.toFixed(0)} p.e.</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px;">Alpha</td>
                            <td style="padding: 6px; text-align: center;">${comparison.average.alpha.toFixed(1)}Â°</td>
                            <td style="padding: 6px; text-align: center;">Â±${comparison.variance.alpha.toFixed(1)}Â°</td>
                        </tr>
                    </table>
                </div>
            `;
        }

        /**
         * Pulisce tutti i canvas
         */
        function clearAllCanvases() {
            renderers.forEach(r => r.clear());
            
            const stereoCanvas = document.getElementById('stereo');
            if (stereoCanvas) {
                const ctx = stereoCanvas.getContext('2d');
                ctx.fillStyle = '#000814';
                ctx.fillRect(0, 0, stereoCanvas.width, stereoCanvas.height);
            }

            document.getElementById('hillasDisplay').innerHTML = 
                '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Genera un evento per visualizzare i parametri di Hillas</p>';
            
            console.log('ğŸ§¹ Canvas puliti');
        }
    </script>
</body>
</html>
